---
title: 'Monitoring Postgres connections'
backlink_href: /docs
backlink_title: 'Documentation'
---

The Connections page in pganalyze tells you about the database connections,
using the data from the `pg_stat_activity`.
Select the server to get the overall connections info, or select the database
as well to get more detailed data such as wait events per database.

This feature is only available on the [Scale Plan](/pricing) and higher.

## Connection States

You can check the history of connection states in Connection States's chart.
The chart is using the data collected every 10 minutes, this section helps you
to understand the trend of your connections total count or some unusual pattern
of the connections such as increase of the Waiting for Lock connections.

When you have many Waiting for Lock connections, the database is likely having
some trouble. You can use the Lock Monitoring feature described below to
determine what query is causing the lock.

You can check the history of connection states with the chart, as well as wait
events history. You can also check the connection traces of each connection,
with the information like query samples or log entries related to the connection.

## Wait Events

Wait Events history chart tells you a historical data of connections waiting
for something. For example, wait event `IO / DataFileRead` indicates that a
process is currently waiting for data to be read from disk or the page cache.

The chart is using the data collected every 10 seconds, but the data is
aggregated with the 150 seconds buckets.

See also [this blog post](https://pganalyze.com/blog/postgres-connection-tracing-wait-event-analysis-and-vacuum-monitoring)
to learn more about wait events.

## Connection Traces

You can find a list of connections in Connection Traces section. The list shows
the current connection data unless the history chart's specific time is clicked.

### Lock Monitoring

You can monitor various wait events including locks with Wait Events section.
Connection States chart also gives you the historical count of connections
that were waiting for a lock.

With lock monitoring, you can dig into this lock information deeper. Within
Connection Traces, whenever the connection/query is waiting for a lock, the
background color of the row of the connection is highlighted.
For the connection/query that is holding a lock (in other words, blocking other
queries) is also highlighted.

* ðŸ”’: the lock icon indicates that the query is blocking other queries, and number indicates how many queries it's blocking
* ðŸ•“: the clock icon indicates that the query is waiting for other queries, and number indicates how many queries it's waiting for

When the trivial query is taking a long time, often it's waiting for something.
With the Lock Monitoring, you can see which queries the query is waiting for.
It is common that that waiting situation is "chained". For example, a query A
is waiting for a query B, and a query B is waiting for a query C. The Lock
Monitoring supports the situation like this, and highlights query C the most
with the lock icon. In this case, you can run `pg_cancel_backend` or
`pg_terminate_backend` to cancel/terminate the query C to unblock the query B
and A.

This information is available for the historical data too. For example, let's
say the database was slow and requests were timing out 3 hours ago. You can
check out the Connection States history chart to see if there were any queries
with "Waiting for Lock" state during that time. If so, you can click the chart
to see the snapshot Connection Traces data of that time with Lock Monitoring
information to see what kind of queries were running and blocking at that time.