---
title: 'PII Filtering'
backlink_href: /docs
backlink_title: 'Documentation'
---

[Personally Identifiable
Information](https://csrc.nist.gov/glossary/term/personally_identifiable_information)
(PII) about your users must be handled very carefully in order to respect your
users' privacy and to comply with laws and regulations your organization is
subject to. When a third-party tool like pganalyze processes your database
statistics and logs, it may involve handling data that includes this PII.

Specifically, pganalyze collects data that may include PII from Postgres logs
and pg_stat_activity.

In order to strike the right balance between what you share with pganalyze and
the impact on monitoring, statistics, and insights available through our
service, we have several collector settings that control metadata collection.

Note that this filtering happens in the collector, the open-source agent that
connects to your database and runs on your infrastructure. Filtering occurs
before the data ever reaches the pganalyze cloud service, or a pganalyze Enterprise Server installation.


## Filter settings

The [`filter_log_secret`](/docs/collector/settings#pii-filtering-settings)
setting determines how content coming from logs is filtered:
 - `credential`: Passwords and other credentials, like private keys
 - `parsing_error`: Text logged by Postgres for parsing errors (could contain anything, including credentials)
 - `statement_text`: All statement texts (which may contain table data if not using bind parameters)
 - `statement_parameter`: Bind parameters for a statement (which may contain table data for statements like INSERT or UPDATE)
 - `table_data`: Table data from constraint violations and COPY errors
 - `ops`: System errors, network errors, file locations, pg_hba.conf contents, and configured commands (e.g. archive command)
 - `unidentified`: Text that could not be identified and might contain secrets

Additionally, the special `all` and `none` setting values apply all and none of the above filters, respectively.

The [`filter_query_sample`](/docs/collector/settings#pii-filtering-settings)
setting determines how content in query samples (individual executions of a
query collected from logs, which include [Automated EXPLAIN](/docs/explain/setup) plans) is filtered:
 - `all`: do not collect any query samples
 - `normalize`: filter query samples to normalize any literal constants used in the query, and normalize collected EXPLAIN plans to remove constant values
 - `none`: do not filter query samples at all

The [`filter_query_text`](/docs/collector/settings#pii-filtering-settings)
setting determines how query text from pg_stat_statements is filtered:
 - `none`: do not filter query text at all
 - `unparsable`: filter out queries that could not be parsed by the collector
Note that these queries are already normalized by pg_stat_statements, so sensitive constants are not a concern here.


## Filtering behavior

By default the pganalyze collector only filters logs that contain syntax errors
(which may contain accidental copy and paste of passwords, etc), or could not be
identified.

```
filter_log_secret: credential,parsing_error,unidentified
```

For servers containing sensitive information in the logs and to maximize data
privacy (at the cost of less useful data in pganalyze) we recommend setting:

```
filter_log_secret: all
filter_query_sample: normalize
filter_query_text: unparsable
```

Note the `normalize` setting for `filter_query_sample`, which will remove all
query parameter values from query samples, including those contained within
automatically collected EXPLAIN plans.

In order to utilize `auto_explain` with this configuration, make sure to set
`auto_explain.log_format` to `json` (other formats are currently not supported
by the EXPLAIN normalization).


## Impact on pganalyze user experience

The values for these settings will affect some parts of pganalyze:

- `filter_log_secret`: log lines visible in [Log Insights](/docs/log-insights)
  are redacted
- `filter_query_sample`: query samples (shown in [Query
   Performance](/docs/query-performance)) and used for [Index
   Advisor](/docs/index-advisor) recommendations
- `filter_query_text`: unparseable queries are omitted from [Query
   Performance](/docs/query-performance)
