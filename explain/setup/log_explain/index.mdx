---
title: 'Log-based EXPLAIN - Automatically EXPLAIN slow queries in Postgres'
backlink_href: /docs/explain/setup
backlink_title: 'Set up automatic EXPLAIN plan collection'
---

We generally recommend using [auto_explain](/docs/explain/setup/auto_explain) to collect EXPLAIN plans automatically.

However, not all environments support the `auto_explain` extension (bundled with Postgres), and therefore we support an alternative mechanism.

## How Log-based EXPLAIN works

This method relies on Postgres logging slow queries to the logs, based on the `log_min_duration_statement` setting.

For example, when we have configured `log_min_duration_statement = 1000`, we will get output like the following for all queries slower than 1,000 ms:

```
LOG: duration: 3205.800 ms execute a2: SELECT "servers".* FROM "servers" WHERE "servers"."id" = 1 LIMIT 2
```

When the pganalyze collector sees these events, it runs EXPLAIN automatically, so you get the EXPLAIN plan for each slow query, together with the log event.

Note the Log-based EXPLAIN method has the following limitations:

* Plans might be different from the executed plans, as the EXPLAIN runs after a statement has finished
* The collector only runs EXPLAIN, not EXPLAIN ANALYZE (to avoid any performance impact)
* Execution metrics, such as I/O time and Buffer counts are not captured
* The pganalyze monitoring user needs to have sufficient permissions to run EXPLAIN on the query
* Plans for some queries may not be attainable due to
  * use of temporary tables
  * query parameter handling limitations
  * differences in `search_path` or other configuration settings

## Pre-requisites

* You have a working [Log Insights integration](/docs/log-insights) that is showing data in the pganalyze UI

## Setup steps

 * [Step 1: Enabling log-based EXPLAIN](/docs/explain/setup/log_explain/01_enable_log_based_explain)
 * [Step 2: Create helper functions](/docs/explain/setup/log_explain/02_create_helper_functions)
 * [Step 3: Testing the configuration](/docs/explain/setup/log_explain/03_testing_the_configuration)
