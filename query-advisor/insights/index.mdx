---
title: 'Query Advisor Insights'
backlink_href: /docs/query-advisor
backlink_title: 'Query Advisor'
---

Query Advisor automatically detects common Postgres query optimization opportunities by analyzing EXPLAIN plans for known performance anti-patterns. This section documents each supported insight type, including detection criteria, optimization strategies, and implementation approaches.

## How insights work

Query Advisor uses a **pattern library approach** to identify optimization opportunities:

1. **Pattern detection**: Analyzes EXPLAIN plans for specific performance anti-patterns
2. **Validation**: Verifies that alternative query plans are likely available
3. **Solution generation**: Provides tested query modifications or configuration changes
4. **Integration**: Seamlessly applies suggestions through pganalyze Workbooks

All insights are based on **deterministic algorithms** derived from Postgres planner behavior - no machine learning involved.

## Currently supported insights

### Inefficient Nested Loops

Detects when Postgres chooses nested loop joins due to row estimation mismatches, often resulting in dramatically slower performance than hash or merge joins.

**[Learn more about Inefficient Nested Loops →](/docs/query-advisor/insights/inefficient-nested-loops)**

### Wrong Index Due To ORDER BY

Identifies queries where Postgres uses an index primarily for sorting while filtering large numbers of rows, indicating that a different index strategy would be more efficient.

**[Learn more about Wrong Index Due To ORDER BY →](/docs/query-advisor/insights/wrong-index-order-by)**

## Optimization techniques

Query Advisor employs several proven Postgres optimization techniques:

### Query rewrites
- **Materialized CTEs**: Forces Postgres to materialize intermediate results to prevent inefficient nested loops
- **Sort prevention**: Uses arithmetic expressions (e.g., `+0`) to prevent Postgres from using index sort order

## Detection methodology

Query Advisor analyzes EXPLAIN plans through a **two-phase process**:

### Phase 1: Initial screening
- Processes millions of plan samples daily** in real-time
- Applies fast heuristics to identify potentially problematic patterns
- Marks plans for deeper analysis without performance impact

### Phase 2: Detailed validation  
- Runs scheduled background analysis on flagged plans
- Verifies schema compatibility (available indexes, constraints)
- Confirms that alternative optimization strategies exist
- Generates specific insights with confidence scores

This approach ensures **scalable analysis** while maintaining accuracy.

## Insight reliability

Query Advisor prioritizes **correctness and determinism**:

### High-confidence patterns
Current insights focus on well-understood Postgres behaviors where:
- Root causes are clearly identified
- Alternative approaches are proven effective  
- Query semantics remain unchanged
- Solutions are widely applicable

### Validation workflow
Each insight includes:
- **Automated detection** of the problematic pattern
- **Schema verification** that alternatives exist
- **Suggested modifications** with clear rationale
- **Testing integration** through pganalyze Workbooks

### When insights may not apply
Occasionally, detected insights may not reproduce during testing due to:
- **Data distribution changes** since original detection
- **Updated statistics** that resolve estimation issues  
- **Concurrent workload** effects during original measurement
- **Cache state differences** between detection and testing

This is normal behavior - database conditions evolve, and Query Advisor adapts accordingly.

## Next steps

- **[Inefficient Nested Loops](/docs/query-advisor/insights/inefficient-nested-loops)** - Learn about join optimization
- **[ORDER BY + LIMIT Issues](/docs/query-advisor/insights/wrong-index-order-by)** - Understand index selection problems  
- **[Set up alerts](/docs/query-advisor/alerts)** - Get notified of new optimization opportunities
- **[Complete workflow guide](/docs/query-advisor/from-insight-to-conclusion)** - See Query Advisor in action