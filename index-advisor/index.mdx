# Limitations

Index Advisor has a number of limitations that affect the types of queries that can
be analyzed (or, in some cases, the quality of the recommendations). We are working
to address these limitations and will update this list as more types of queries and
schemas are supported.

## Overall
 - Queries on partitioned tables do not take the hierarchy into account, so you will
   receive recommendations for individual partitions.
 - Queries that call custom functions are not supported.
 - Postgres parameter markers ($1, $2, etc.) are supported, but sometimes there is not
   enough information to infer parameter types, leading to errors in analysis.

## In pganalyze
 - Index Advisor always references the latest version of your schema and database statistics. If you are
   reviewing recommendations for a historical query and your schema or statistics have changed significantly,
   you may get errors or inferior recommendations.
 - Custom search_path values are not supported. If the tables in your query are not schema-qualified,
   we attempt a best-effort lookup, but note that this may find tables in a different schema in your
   database.
 - Custom types, including ENUMs and DOMAINs, are not supported.
 - Temporary tables are not supported.
 - Extension support is very limited, but handled automatically. The following extensions are supported:
   - hstore
   - citext
   - pg_trgm
   - intarray

## In standalone tool
 - Temporary tables are not supported. You can work around this by including any temporary tables in the
   schema DDL as if they were regular tables.
 - Extension support is limited. Extensions must be specified in the schema DDL with `CREATE EXTENSION`.
   The following extensions are supported:
   - btree_gin
   - btree_gist
   - citext
   - cube
   - dict_int
   - earthdistance
   - fuzzystrmatch
   - hstore
   - intarray
   - isn
   - lo
   - ltree
   - pgcrypto
   - pg_trgm
   - postgres_fdw
   - seg
   - tablefunc
   - tcn
   - tsm_system_rows
   - tsm_system_time
   - unaccent
   - uuid-ossp

# Common Errors

Many of the errors you are likely to run into in Index Advisor output
are due to the limitations outlined above. Please review the limitations
and, if applicable, try the workarounds we suggest.

## In pganalyze

Some errors are due to current limitations of the Index Advisor:
 - Unsupported statement type
   - No table scans could be found in the query, so no indexing recommendations
     are possible.
 - relation ... does not exist
   - If the relation is a temporary table, those are not supported.
   - If looking at a historical query and the table in question has since been
     dropped, no index recommendations are possible.
   - If using the `ignore_schema_regexp` setting or the deprecated `ignore_table_pattern` setting
     and the referenced table is ignored, no index recommendations are possible.
   - If not collecting schema statistics (check the Schema Statistics menu item in pganalyze),
     no index recommendations are possible.
 - column ... does not exist
   - If a custom `search_path` was set for the query and the query does not use schema-qualified
     table names, we look up tables on a best-effort basis and may find the wrong table; no
     index recommendations are possible in this case.
 - type ... does not exist
   - Custom types are not supported.
 - Unexpected execution of function 
   - Custom functions are not supported.

Many other problems are due to an outdated collector version.
 - Partitioned table support requires collector version 0.33.0 or higher
   - Queries on partitioned tables need metadata not reported by older collector
     versions.
 - there is no parameter $0
   - Older collector versions used a query normalization mechanism that
     generates nonstandard parameter markers.
 - type modifiers must be simple constants or identifiers
   - Older collector versions used a query normalization mechanism that
     can mangle some query texts.
 - column ... must appear in the GROUP BY clause
   - As above, this is due to an invalid query normalization from an
     older collector version.

All of these problems can be resolved by upgrading to the latest collector.


## In standalone tool

Some errors are due to current limitations of the Index Advisor:
 - Unexpected execution of function 
   - Custom functions are not supported.
 - Unsupported extension: ...
   - Only a limited set of extensions are supported (see above).
 - operator class ... does not exist
   - If using parameter markers in your query, try adding a cast to the parameter to indicate the data type
 - operator does not exist
   - If using parameter markers in your query, try adding a cast to the parameter to indicate the data type

Many others are due to incomplete schmea definition:
 - relation ... does not exist
   - Ensure the relation is defined in your schema DDL. If this is a temporary table, you can
     define it as a regular table in the schema.
 - column ... does not exist
   - Ensure the column exists in your table definition in the schema DDL.
 - type ... does not exist
   - Ensure the type definition exists in the schema DDL.
